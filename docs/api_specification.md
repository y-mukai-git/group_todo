# API仕様書 - グループTODO

本ドキュメントは、グループTODOアプリで使用するSupabase Edge Functions APIの仕様を記載しています。

---

## 目次

1. [共通仕様](#共通仕様)
2. [アプリ起動・初期化](#アプリ起動初期化)
3. [ユーザー管理](#ユーザー管理)
4. [グループ管理](#グループ管理)
5. [招待管理](#招待管理)
6. [メンバー管理](#メンバー管理)
7. [TODO管理](#todo管理)
8. [定期TODO管理](#定期todo管理)
9. [セットTODO管理](#セットtodo管理)
10. [その他](#その他)

---

## 共通仕様

### エラーハンドリングパターン

すべてのAPIは以下の共通パターンでエラーハンドリングされます。

| 状態 | 出力方法 | エラーログ | 継続可否 |
|------|----------|------------|----------|
| メンテナンス中 | MaintenanceDialog | なし | × |
| 正常処理 | SnackBar（成功）または表示なし | なし | ○ |
| ビジネスエラー | SnackBar（エラー）またはErrorDialog | 場合による | ○ |
| システムエラー | ErrorDialog | あり | 場合による |

### メンテナンスメッセージ

```
システムメンテナンス中です
{HH:MM}までお待ちください
```
※終了予定時刻がない場合は「しばらく時間をおいてから再度お試しください」

### エラーメッセージ共通サフィックス

システムエラー時は以下のサフィックスが付与されます：
```
しばらく時間をおいてから再度お試しください
```

---

## アプリ起動・初期化

### check-app-status

アプリの起動可否を確認します。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | スプラッシュ画面、設定画面 |
| **呼び出しタイミング** | アプリ起動時、設定画面遷移時 |
| **目的** | メンテナンス状態と強制アップデート要否の確認 |

**エラーハンドリング**:

| 状態 | メッセージ | 出力方法 | 継続可否 |
|------|----------|----------|----------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | × |
| 正常 | 表示なし | - | ○ |
| エラー（起動時） | アプリの初期化に失敗しました | ErrorDialog（閉じる不可） | × |
| エラー（設定画面） | バージョン情報の取得に失敗しました | ErrorDialog | ○ |

---

### get-user-by-device

デバイスIDでユーザー情報を取得します。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | スプラッシュ画面 |
| **呼び出しタイミング** | アプリ起動時（既存ユーザーの場合） |
| **目的** | デバイスIDでユーザー情報を取得 |

**エラーハンドリング**:

| 状態 | メッセージ | 出力方法 | 継続可否 |
|------|----------|----------|----------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | × |
| 正常 | 表示なし | - | ○ |
| エラー | アプリの初期化に失敗しました | ErrorDialog（閉じる不可） | × |

---

### initialize-user-cache

全データ（グループ、TODO、定期TODO、セットTODO等）をキャッシュに読み込みます。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | スプラッシュ画面、データ引き継ぎ画面、各画面（リフレッシュ時） |
| **呼び出しタイミング** | アプリ起動時、新規ユーザー作成後、データ引き継ぎ後、下スワイプリフレッシュ時 |
| **目的** | キャッシュデータの初期化・更新 |

**エラーハンドリング**:

| 状態 | メッセージ | 出力方法 | 継続可否 |
|------|----------|----------|----------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | × |
| 正常 | 表示なし | - | ○ |
| エラー（起動時） | アプリの初期化に失敗しました | ErrorDialog（閉じる不可） | × |
| エラー（リフレッシュ時） | データの更新に失敗しました | ErrorDialog | ○ |

---

## ユーザー管理

### create-user

新規ユーザーを作成します。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | データ引き継ぎ画面 |
| **呼び出しタイミング** | 「新規ユーザーとして始める」ボタン押下時 |
| **目的** | 新規ユーザー作成 |

**エラーハンドリング**:

| 状態 | メッセージ | 出力方法 | 継続可否 |
|------|----------|----------|----------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | × |
| 正常 | 表示なし | - | ○ |
| エラー | ユーザー作成に失敗しました | ErrorDialog（閉じる不可） | × |

---

### transfer-user-data

既存ユーザーのデータを引き継ぎます。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | データ引き継ぎ画面 |
| **呼び出しタイミング** | 「データを引き継ぐ」ボタン押下時 |
| **目的** | 既存ユーザーのデータ引き継ぎ |

**エラーハンドリング**:

| 状態 | メッセージ | 出力方法 | 継続可否 |
|------|----------|----------|----------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | × |
| 正常 | データ引き継ぎが完了しました | SnackBar（成功） | ○ |
| ID/パスワード誤り | ユーザーIDとパスワードをご確認の上、再度入力してください | SnackBar（エラー） | ○ |
| エラー | データ引き継ぎ処理でエラーが発生しました | ErrorDialog（閉じる不可） | × |

---

### set-transfer-password

データ引き継ぎ用パスワードを設定します。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | データ引き継ぎ設定ボトムシート |
| **呼び出しタイミング** | 「設定」ボタン押下時 |
| **目的** | データ引き継ぎ用パスワードの設定 |

**エラーハンドリング**:

| 状態 | メッセージ | 出力方法 | 継続可否 |
|------|----------|----------|----------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | × |
| 正常 | パスワードを設定しました | SnackBar（成功） | ○ |
| エラー | パスワードの設定に失敗しました | ErrorDialog | ○ |

---

### update-user-profile

ユーザーのプロフィール（表示名・アバター画像）を更新します。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | プロフィール編集ボトムシート |
| **呼び出しタイミング** | 「保存」ボタン押下時 |
| **目的** | プロフィール更新 |

**エラーハンドリング**:

| 状態 | メッセージ | 出力方法 | エラー後処理 |
|------|----------|----------|--------------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | - |
| 正常 | プロフィールを更新しました | SnackBar（成功） | - |
| エラー | プロフィールの更新に失敗しました | ErrorDialog | データリフレッシュ |

---

## グループ管理

### create-group

新しいグループを作成します。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | グループ一覧画面、ホーム画面 |
| **呼び出しタイミング** | グループ作成ボトムシートで「作成」ボタン押下時 |
| **目的** | グループ作成 |

**エラーハンドリング**:

| 状態 | メッセージ | 出力方法 | エラー後処理 |
|------|----------|----------|--------------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | - |
| 正常 | グループを作成しました | SnackBar（成功） | - |
| エラー | グループの作成に失敗しました | ErrorDialog | データリフレッシュ |

---

### update-group

グループ情報を更新します。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | グループ詳細画面 |
| **呼び出しタイミング** | グループ情報編集後「保存」ボタン押下時 |
| **目的** | グループ名・説明等の更新 |

**エラーハンドリング**:

| 状態 | メッセージ | 出力方法 | エラー後処理 |
|------|----------|----------|--------------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | - |
| 正常 | グループを更新しました | SnackBar（成功） | - |
| エラー | グループ情報の更新に失敗しました | ErrorDialog | データリフレッシュ |

---

### delete-group

グループを削除します。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | グループ一覧画面 |
| **呼び出しタイミング** | グループ長押し→「削除」選択→確認ダイアログで「削除」押下時 |
| **目的** | グループ削除 |

**エラーハンドリング**:

| 状態 | メッセージ | 出力方法 | エラー後処理 |
|------|----------|----------|--------------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | - |
| 正常 | グループを削除しました | SnackBar（成功） | - |
| エラー | グループの削除に失敗しました | ErrorDialog | データリフレッシュ |

---

### update-group-order

グループの並び順を保存します。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | グループ一覧画面 |
| **呼び出しタイミング** | グループをドラッグ&ドロップして並び替え後、「完了」ボタン押下時 |
| **目的** | グループ並び順の保存 |

**エラーハンドリング**:

| 状態 | メッセージ | 出力方法 | エラー後処理 |
|------|----------|----------|--------------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | 並び替えキャンセル |
| 正常 | グループ順を変更しました | SnackBar（成功） | - |
| エラー | 並び順の保存に失敗しました | ErrorDialog | 並び替えキャンセル、データリフレッシュ |

---

## 招待管理

### get-pending-invitations

保留中のグループ招待情報を取得します。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | グループ一覧画面 |
| **呼び出しタイミング** | 画面遷移時 |
| **目的** | 保留中招待の取得 |

**エラーハンドリング**:

| 状態 | メッセージ | 出力方法 | 継続可否 |
|------|----------|----------|----------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | × |
| 正常 | 表示なし | - | ○ |
| エラー | 招待情報の取得に失敗しました | ErrorDialog | ○ |

---

### accept-invitation

グループ招待を承認します。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | グループ一覧画面 |
| **呼び出しタイミング** | 招待カードで「承認」ボタン押下時 |
| **目的** | 招待承認 |

**エラーハンドリング**:

| 状態 | メッセージ | 出力方法 | エラー後処理 |
|------|----------|----------|--------------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | - |
| 正常 | 招待を承認しました | SnackBar（成功） | - |
| 招待が見つからない | この招待は既に処理済みです | SnackBar（エラー） | なし |
| グループ情報取得失敗 | 招待は承認されましたが、グループ情報の取得に失敗しました | ErrorDialog | データリフレッシュ |
| エラー | 招待の承認に失敗しました | ErrorDialog | データリフレッシュ |

---

### reject-invitation

グループ招待を却下します。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | グループ一覧画面 |
| **呼び出しタイミング** | 招待カードで「却下」ボタン押下時 |
| **目的** | 招待却下 |

**エラーハンドリング**:

| 状態 | メッセージ | 出力方法 | エラー後処理 |
|------|----------|----------|--------------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | - |
| 正常 | 招待を却下しました | SnackBar（成功） | - |
| 招待が見つからない | この招待は既に処理済みです | SnackBar（エラー） | なし |
| エラー | 招待の却下に失敗しました | ErrorDialog | データリフレッシュ |

---

### validate-user-for-invitation

招待するユーザーの存在確認と招待可否を検証します。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | メンバー管理ボトムシート |
| **呼び出しタイミング** | 「招待」タブでユーザーID入力後「招待」ボタン押下時 |
| **目的** | ユーザー検証 |

**エラーハンドリング**:

| 状態 | メッセージ | 出力方法 | 継続可否 |
|------|----------|----------|----------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | × |
| 正常 | （確認ダイアログへ遷移） | - | ○ |
| ユーザーが見つからない | 指定されたユーザーIDが見つかりません | SnackBar（エラー） | ○ |
| 既にメンバー | このユーザーは既にメンバーです | SnackBar（エラー） | ○ |
| 既に招待済み | このユーザーは既に招待済みです | SnackBar（エラー） | ○ |
| オーナー以外 | オーナーのみが招待できます | SnackBar（エラー） | ○ |
| エラー | 招待に失敗しました | ErrorDialog | ○ |

---

### invite-user

ユーザーをグループに招待します。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | メンバー管理ボトムシート |
| **呼び出しタイミング** | validate-user-for-invitation成功後、確認ダイアログで「招待」ボタン押下時 |
| **目的** | ユーザー招待 |

**エラーハンドリング**:

| 状態 | メッセージ | 出力方法 | エラー後処理 |
|------|----------|----------|--------------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | - |
| 正常 | 招待を送信しました | SnackBar（成功） | - |
| エラー | 招待に失敗しました | ErrorDialog | データリフレッシュ |

---

## メンバー管理

### change-member-role

メンバーのロールを変更します。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | メンバー管理ボトムシート |
| **呼び出しタイミング** | メンバーのロール変更時 |
| **目的** | ロール変更 |

**エラーハンドリング**:

| 状態 | メッセージ | 出力方法 | エラー後処理 |
|------|----------|----------|--------------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | - |
| 正常 | {displayName}のロールを変更しました | SnackBar（成功） | - |
| エラー | ロールの変更に失敗しました | ErrorDialog | データリフレッシュ |

---

### remove-group-member

グループからメンバーを削除します。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | グループ詳細画面 |
| **呼び出しタイミング** | メンバー削除時、またはグループ脱退時 |
| **目的** | メンバー削除/脱退 |

**エラーハンドリング（メンバー削除時）**:

| 状態 | メッセージ | 出力方法 | エラー後処理 |
|------|----------|----------|--------------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | - |
| 正常 | メンバーを削除しました | SnackBar（成功） | - |
| エラー | メンバーの削除に失敗しました | ErrorDialog | データリフレッシュ |

**エラーハンドリング（グループ脱退時）**:

| 状態 | メッセージ | 出力方法 | エラー後処理 |
|------|----------|----------|--------------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | - |
| 正常 | グループから脱退しました | SnackBar（成功） | 画面を閉じる |
| エラー | グループの脱退に失敗しました | ErrorDialog | データリフレッシュ |

---

## TODO管理

### create-todo

TODOを作成します。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | グループ詳細画面、ホーム画面 |
| **呼び出しタイミング** | TODO作成ボトムシートで「作成」ボタン押下時 |
| **目的** | TODO作成 |

**エラーハンドリング**:

| 状態 | メッセージ | 出力方法 | エラー後処理 |
|------|----------|----------|--------------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | - |
| 正常 | TODOを作成しました | SnackBar（成功） | - |
| エラー | TODOの作成に失敗しました | ErrorDialog | データリフレッシュ |

**備考**: グループ未選択時に新規グループを同時作成する場合、エラーメッセージは「TODO/グループの作成に失敗しました」

---

### update-todo

TODOを更新します。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | グループ詳細画面、ホーム画面 |
| **呼び出しタイミング** | TODO編集後「保存」ボタン押下時 |
| **目的** | TODO更新 |

**エラーハンドリング**:

| 状態 | メッセージ | 出力方法 | エラー後処理 |
|------|----------|----------|--------------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | - |
| 正常 | TODOを更新しました | SnackBar（成功） | - |
| エラー | TODOの更新に失敗しました | ErrorDialog | データリフレッシュ |

---

### delete-todo

TODOを削除します。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | グループ詳細画面 |
| **呼び出しタイミング** | TODOスワイプ削除時、または削除ボタン押下時 |
| **目的** | TODO削除 |

**エラーハンドリング**:

| 状態 | メッセージ | 出力方法 | エラー後処理 |
|------|----------|----------|--------------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | - |
| 正常 | TODOを削除しました | SnackBar（成功） | - |
| エラー | TODOの削除に失敗しました | ErrorDialog | データリフレッシュ |

---

### toggle-todo-completion

TODOの完了状態を切り替えます。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | グループ詳細画面、ホーム画面 |
| **呼び出しタイミング** | TODOのチェックボックス操作時 |
| **目的** | 完了/未完了の切り替え |

**エラーハンドリング**:

| 状態 | メッセージ | 出力方法 | エラー後処理 |
|------|----------|----------|--------------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | - |
| 正常 | 表示なし | - | - |
| エラー | TODO状態の変更に失敗しました | ErrorDialog | データリフレッシュ |

---

## 定期TODO管理

### create-recurring-todo

定期TODOを作成します。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | 定期TODO作成/編集ボトムシート |
| **呼び出しタイミング** | 「作成」ボタン押下時 |
| **目的** | 定期TODO作成 |

**エラーハンドリング**:

| 状態 | メッセージ | 出力方法 | エラー後処理 |
|------|----------|----------|--------------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | - |
| 正常 | 定期TODOを作成しました | SnackBar（成功） | - |
| エラー | 定期TODOの作成に失敗しました | ErrorDialog | データリフレッシュ |

---

### update-recurring-todo

定期TODOを更新します。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | 定期TODO作成/編集ボトムシート |
| **呼び出しタイミング** | 「保存」ボタン押下時 |
| **目的** | 定期TODO更新 |

**エラーハンドリング**:

| 状態 | メッセージ | 出力方法 | エラー後処理 |
|------|----------|----------|--------------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | - |
| 正常 | 定期TODOを更新しました | SnackBar（成功） | - |
| エラー | 定期TODOの更新に失敗しました | ErrorDialog | データリフレッシュ |

---

### delete-recurring-todo

定期TODOを削除します。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | グループ詳細画面 |
| **呼び出しタイミング** | 定期TODO長押し→「削除」選択→確認ダイアログで「削除」押下時 |
| **目的** | 定期TODO削除 |

**エラーハンドリング**:

| 状態 | メッセージ | 出力方法 | エラー後処理 |
|------|----------|----------|--------------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | - |
| 正常 | 定期タスクを削除しました | SnackBar（成功） | - |
| エラー | 定期タスクの削除に失敗しました | ErrorDialog | データリフレッシュ |

---

### toggle-recurring-todo

定期TODOの有効/無効を切り替えます。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | グループ詳細画面 |
| **呼び出しタイミング** | 定期TODOのトグルスイッチ操作時 |
| **目的** | 有効/無効の切り替え |

**エラーハンドリング**:

| 状態 | メッセージ | 出力方法 | エラー後処理 |
|------|----------|----------|--------------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | - |
| 正常 | 表示なし | - | - |
| エラー | 定期タスクの切り替えに失敗しました | ErrorDialog | データリフレッシュ |

---

## セットTODO管理

### create-quick-action

セットTODOを作成します。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | セットTODO作成/編集ボトムシート |
| **呼び出しタイミング** | 「作成」ボタン押下時 |
| **目的** | セットTODO作成 |

**エラーハンドリング**:

| 状態 | メッセージ | 出力方法 | エラー後処理 |
|------|----------|----------|--------------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | - |
| 正常 | セットTODOを作成しました | SnackBar（成功） | - |
| エラー | セットTODOの作成に失敗しました | ErrorDialog | データリフレッシュ |

---

### update-quick-action

セットTODOを更新します。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | セットTODO作成/編集ボトムシート |
| **呼び出しタイミング** | 「保存」ボタン押下時 |
| **目的** | セットTODO更新 |

**エラーハンドリング**:

| 状態 | メッセージ | 出力方法 | エラー後処理 |
|------|----------|----------|--------------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | - |
| 正常 | セットTODOを更新しました | SnackBar（成功） | - |
| エラー | セットTODOの更新に失敗しました | ErrorDialog | データリフレッシュ |

---

### delete-quick-action

セットTODOを削除します。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | グループ詳細画面 |
| **呼び出しタイミング** | セットTODO長押し→「削除」選択→確認ダイアログで「削除」押下時 |
| **目的** | セットTODO削除 |

**エラーハンドリング**:

| 状態 | メッセージ | 出力方法 | エラー後処理 |
|------|----------|----------|--------------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | - |
| 正常 | クイックアクションを削除しました | SnackBar（成功） | - |
| エラー | クイックアクションの削除に失敗しました | ErrorDialog | データリフレッシュ |

---

### execute-quick-action

セットTODOを実行します（複数TODOを一括作成）。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | セットTODO一覧ボトムシート |
| **呼び出しタイミング** | セットTODOをタップ時 |
| **目的** | セットTODO実行（TODO一括作成） |

**エラーハンドリング**:

| 状態 | メッセージ | 出力方法 | エラー後処理 |
|------|----------|----------|--------------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | - |
| 正常 | TODOを追加しました | SnackBar（成功） | - |
| エラー | セットTODOの実行に失敗しました | ErrorDialog | データリフレッシュ |

---

## その他

### submit-contact-inquiry

お問い合わせを送信します。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | お問い合わせボトムシート |
| **呼び出しタイミング** | 「送信」ボタン押下時 |
| **目的** | お問い合わせ送信 |

**エラーハンドリング**:

| 状態 | メッセージ | 出力方法 | 継続可否 |
|------|----------|----------|----------|
| メンテナンス中 | メンテナンスメッセージ | MaintenanceDialog | × |
| 正常 | お問い合わせを送信しました | SnackBar（成功） | ○ |
| エラー | お問い合わせの送信に失敗しました | ErrorDialog | ○ |

---

### log-error

エラーログを記録します。

| 項目 | 内容 |
|------|------|
| **呼び出し画面** | 全画面（エラー発生時） |
| **呼び出しタイミング** | システムエラー発生時 |
| **目的** | エラーログ記録 |

**備考**: このAPIはエラー発生時に自動的に呼び出され、ユーザーには表示されません。

---

## 更新履歴

| 日付 | 内容 |
|------|------|
| 2025-11-28 | 初版作成 |

---

**最終更新日**: 2025-11-28
