# グループTODO - 今後の改善計画書

## ドキュメント概要

- **作成日**: 2025-11-07
- **対象**: 今後実装・改善を検討している機能と開発プロセス
- **目的**: 将来的な機能拡張・開発効率化の計画を記録する

---

## 1. 機能拡張計画

### 1.1 通知機能

#### 1.1.1 通知設定UI

**現状**:
- データベースには通知設定フィールドが存在
  - `notification_deadline`: 期限通知
  - `notification_new_todo`: 新規TODO通知
  - `notification_assigned`: 担当TODO通知
- しかし画面実装は存在しない

**実装予定**:
- 設定画面に通知設定セクションを追加
- 各通知のON/OFF切り替え
- 通知タイミングの設定（期限の何日前等）

#### 1.1.2 プッシュ通知

**現状**:
- プッシュ通知は未実装
- グループ招待も画面内のセクション表示のみ

**実装予定**:
- Firebase Cloud Messaging（FCM）を使用
- 以下のタイミングで通知:
  - グループに招待された時
  - 期限が近いTODOがある時
  - 新規TODOが追加された時
  - 自分が担当者に設定された時
- 通知設定に基づく配信制御

**技術検討**:
- Supabase Edge Functionsから FCM API呼び出し
- デバイストークンの管理（usersテーブルに追加）
- 通知履歴の管理

### 1.2 オフライン対応

**現状**:
- オンライン必須の設計
- ネットワーク障害時はアプリ使用不可

**実装予定**:
- Supabase Realtimeによるリアルタイム同期
- ローカルストレージへの一時保存（SQLite等）
- ネットワーク復帰時の自動同期
- 競合解決ロジック（最終更新優先等）

**技術検討**:
- Hive / Isar / Drift（SQLite）の比較検討
- Supabase Realtimeの活用
- オフラインキューの実装

### 1.3 画像添付機能

**実装予定**:
- TODOに画像を添付できる機能
- 用途例: 買い物リストの商品写真、家事の参考画像
- Supabase Storageを活用
- 画像圧縮・リサイズ処理

**技術検討**:
- 画像アップロード処理（Edge Function経由）
- 画像表示（キャッシュ、ローディング）
- 画像削除時のストレージクリーンアップ

### 1.4 TODO完了統計・インサイト機能

**実装予定**:
- TODO完了率の統計表示
- グループメンバーの貢献度分析
- 定期TODOの完了傾向分析
- グラフ・チャートでの可視化

**技術検討**:
- fl_chart / syncfusion_flutter_chartsの比較検討
- 集計処理（Edge Function / PostgreSQL Function）
- キャッシュ戦略

### 1.5 個人TODO機能

**実装予定**:
- グループに所属しない個人用TODO
- 家族と共有しない個人的なタスク管理
- グループTODOと同じUI/UX

**技術検討**:
- 個人TODO専用テーブルの追加
- 既存TODOテーブルの拡張（group_id nullable化）
- グループTODOと個人TODOの切り替えUI

### 1.6 TODO詳細画面

**現状**:
- TODO詳細はボトムシート表示のみ

**実装予定**:
- TODO詳細専用画面
- コメント一覧表示
- 編集履歴表示
- 画像添付（1.3実装後）

---

## 2. デザイン改善計画

### 2.1 ダークモード実装

**現状**:
- ライトテーマのみ実装
- ダークテーマ定義済み（未使用）

**実装予定**:
- システム設定連動（`ThemeMode.system`）
- 設定画面から手動切り替え
- ユーザープリファレンスに保存

### 2.2 多言語対応

**実装予定**:
- 英語対応（国際化）
- `intl`パッケージを使用
- 設定画面から言語切り替え

**優先度**:
- 低（国内ユーザーが主）

---

## 3. 開発プロセス改善計画

### 3.1 自動化スクリプト

#### 3.1.1 DEV/STG/PROD構成比較スクリプト

**背景**:
- 2025-11-04にSTG環境へのマイグレーション時、change-member-role Edge Functionが漏れる問題が発生
- 手動での差分確認に限界がある

**実装予定**:
```bash
# 使用例
./scripts/compare_environments.sh dev stg

# 出力
# Edge Functions差分:
# - DEVにのみ存在: generate-transfer-code
# - STGにのみ存在: (なし)
#
# データベーステーブル差分:
# (差分なし)
```

**機能**:
- Edge Functions一覧の比較
- データベーステーブル構成の比較
- 差分の詳細表示
- マイグレーション推奨リストの生成

#### 3.1.2 マイグレーション実行スクリプト

**実装予定**:
```bash
# 使用例
./scripts/migrate.sh stg 20251105_change_description_length.sql

# 機能
# 1. 環境認証情報の読み込み
# 2. 実行前の構成スナップショット取得
# 3. マイグレーション実行
# 4. 実行後の構成スナップショット取得
# 5. 差分確認
# 6. ログ記録
```

#### 3.1.3 Edge Functionsデプロイスクリプト

**実装予定**:
```bash
# 使用例
./scripts/deploy_functions.sh stg

# 機能
# 1. 全Edge Functionsをデプロイ
# 2. デプロイ前後の差分確認
# 3. デプロイ失敗時のロールバック
# 4. ログ記録
```

### 3.2 CI/CDパイプライン

#### 3.2.1 GitHub Actions構成

**実装予定**:

**PR作成時**:
- Dart Analyzer実行
- Dart Format チェック
- Flutter Test実行
- ビルドチェック（iOS / Android / Web）

**mainブランチマージ時**:
- DEV環境への自動デプロイ
  - Edge Functions
  - マイグレーション（未適用分）
- デプロイ後の自動テスト

**Releaseタグ作成時**:
- STG環境への自動デプロイ
- デプロイ後の自動テスト
- PROD環境へのデプロイ承認待ち

#### 3.2.2 自動テスト

**実装予定**:
- Unit Test（Service層）
- Widget Test（UI層）
- Integration Test（E2E）
- Edge Functions Test（Deno Test）

**技術検討**:
- テストカバレッジ目標: 70%以上
- Codecov連携

### 3.3 コード品質管理

#### 3.3.1 静的解析強化

**実装予定**:
- `analysis_options.yaml`の厳密化
- カスタムLintルールの追加
- pre-commit hookの導入

#### 3.3.2 コードレビューチェックリスト

**現状**:
- REVIEW_CHECKLIST.md作成済み（2025-11-07）

**実装予定**:
- レビュー時の自動チェック
- チェックリスト項目の自動検証（可能な範囲）

---

## 4. パフォーマンス最適化

### 4.1 画像最適化

**実装予定**:
- 画像遅延ロード
- 画像キャッシュ戦略
- サムネイル生成

### 4.2 API呼び出し最適化

**実装予定**:
- GraphQLの検討（RESTの代替）
- バッチ処理の導入
- キャッシュ戦略の見直し

### 4.3 リアルタイム同期の最適化

**実装予定**:
- Supabase Realtimeの活用
- WebSocket接続の最適化
- 差分同期の実装

---

## 5. セキュリティ強化

### 5.1 認証強化

**実装予定**:
- 生体認証対応（指紋・Face ID）
- 二要素認証（2FA）の検討

### 5.2 データ暗号化

**実装予定**:
- ローカルストレージの暗号化
- 通信の暗号化（既にHTTPS使用中）

---

## 6. 実装優先度

### 高優先度

1. **通知機能** - ユーザー体験向上に直結
2. **自動化スクリプト** - 開発効率化・品質向上
3. **ダークモード** - ユーザー要望の多い機能

### 中優先度

4. **CI/CDパイプライン** - 開発効率化
5. **画像添付機能** - 利便性向上
6. **TODO完了統計** - 付加価値向上

### 低優先度

7. **オフライン対応** - 技術的難易度高
8. **多言語対応** - 現時点での需要は低い
9. **個人TODO機能** - グループTODOで代替可能

---

## 7. 段階的導入プラン

### Phase 1: 基盤整備（3ヶ月）

- 自動化スクリプト構築
- CI/CDパイプライン構築
- テスト環境整備

### Phase 2: 主要機能追加（3ヶ月）

- 通知機能実装
- ダークモード実装
- 画像添付機能実装

### Phase 3: 高度な機能追加（3-6ヶ月）

- TODO完了統計実装
- オフライン対応実装
- 個人TODO機能実装

---

**最終更新日**: 2025-11-07
