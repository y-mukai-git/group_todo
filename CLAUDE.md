# グループTODO - Claude Code 開発仕様書

## 【最重要】開発ルール（絶対遵守）

### 🚨 事前許可の徹底（違反厳禁）
- **すべての作業の前に必ずCLAUDE.mdの開発ルールを確認する**
- **UI・動作・ログ・設定に影響するすべての修正は必ず事前に許可を取る**
- **「軽微な修正」「明らかに問題ない修正」でも許可なしでは絶対に実行しない**
- **デバッグログ追加・削除も動作に影響するため事前許可必須**
- **ファイル内容の読み取り・確認のみは許可不要、修正・編集は必ず許可必要**

### 🔧 必須作業フロー（厳守）
1. **セッション継続性チェック**（日時確認・当日ログファイル確認・前日ログ確認）
2. **指示受領**（受領と同時に当日ログファイルに記録）
3. **CLAUDE.md開発ルール確認**
4. **影響範囲分析**（UI/動作/設定/ログへの影響チェック）
5. **許可が必要な場合：詳細な修正内容を説明し許可を求める**
6. **許可取得後：作業実行**（作業完了と同時に当日ログファイルに記録）
7. **許可なしでの勝手な修正は絶対禁止**

### ❌ 違反防止の徹底
- **セッション開始時に必ずこのルールを再確認する**
- **不明・迷う場合は必ず許可を求める**
- **「勝手に修正して後で謝る」は絶対に行わない**
- **過去に同様の修正をしていても、毎回許可を取る**
- **緊急時や明らかな場合でも例外なし**

### 📝 セッション継続性確保（必須・強制実行）

#### 🚨 セッション開始時の強制チェック（例外なし）
- **最優先タスク**：すべての作業に先立ち、以下を物理的に実行する
- **1. 現在日時確認**：Bashツールで`date`コマンドを実行し、正確な日付・時刻を把握
- **2. 当日ログファイル確認**：`session_logs/YYYY-MM-DD.md`の存在を`ls`で確認
- **3. ファイル不在時**：当日ログファイルが存在しない場合は即座にWriteツールで作成
- **4. 前日ログ確認**：Readツールで前日のsession_logsを読み込み、継続事項を把握
- **チェック完了証明**：「セッション継続性チェック完了：[日時]」をユーザーに明示的に報告

#### 📋 リアルタイムログ更新（忘却防止システム）
- **更新タイミング**：以下の場面で **必ず** 当日ログファイルを更新
  - ユーザー指示受領時
  - 作業完了時（小さな作業でも）
  - 問題発見時
  - セッション終了予告時
- **更新必須内容**：
  - 正確な時刻（XX:XX頃）
  - ユーザー指示の要約
  - 実行した作業・結果
  - 発見した問題・課題
  - 次の作業予定
- **日付絶対原則**：過去日付ファイルへの記録は完全禁止、必ず当日日付ファイルに記録

## プロジェクト概要

- **プロジェクト名**: グループTODO
- **フレームワーク**: Flutter 3.24+
- **状態管理**: StatefulWidget + Service Layer Pattern
- **データベース**: Supabase (PostgreSQL, Authentication, Storage)
- **アーキテクチャ**: Service-based Architecture with Clean separation
- **開発状況**: プロジェクト初期セットアップ段階

### 🏗️ アプリ基本設計方針（重要）
- **DB接続前提**: このアプリはSupabaseデータベースへの接続が必須で動作するアプリ
- **フォールバック禁止**: DB接続失敗時のローカルデータフォールバック機能は実装しない
- **エラー時動作**: API接続失敗・DB接続失敗時はエラー画面に遷移し、正常動作を停止する
- **オンライン必須**: オフライン時やネットワーク障害時はアプリ使用不可として扱う

## 技術スタック

- Flutter SDK 3.24+
- **Supabase**: PostgreSQL データベース・認証・リアルタイム同期
- SharedPreferences (ローカル設定・キャッシュ)
- HTTP client for API calls

## ディレクトリ構成

```
group_todo/
├── 🗄️ **データベース・バックエンド**
│   └── database/               # Supabase PostgreSQL 管理
│       ├── schema/             # テーブル定義・DDL
│       ├── data/               # マスターデータ・テストデータ
│       └── scripts/            # 運用スクリプト
│
├── 📱 **アプリケーション本体**
│   └── lib/
│       ├── core/                    # 共通設定・ユーティリティ
│       │   ├── config/
│       │   │   └── environment_config.dart # 統合環境設定管理
│       │   └── utils/
│       │
│       ├── data/                    # データ層
│       │   └── models/              # Supabase PostgreSQLモデル
│       │
│       ├── presentation/            # UI層
│       │   ├── screens/
│       │   ├── themes/
│       │   │   └── app_theme.dart       # Material Design 3テーマ
│       │   └── widgets/             # 再利用ウィジェット
│       │
│       ├── services/                # ビジネスロジック層
│       │   └── supabase/            # Supabase直接連携
│       │
│       └── main.dart                # アプリエントリーポイント
│
├── 🔧 **設定・環境**
│   ├── android/                     # Android設定
│   ├── ios/                         # iOS設定
│   └── web/                         # Web版設定
│
├── 🗂️ **データ管理**
│   └── assets/                      # アセットファイル
│       ├── config/
│       │   └── environments.json        # 統合環境設定（Supabase）
│       └── icons/                   # アプリアイコン
│
├── 📚 **ドキュメント**
│   ├── docs/                        # 技術ドキュメント
│   │   ├── requirements.md          # 要件定義書
│   │   ├── current_architecture.md  # アーキテクチャ仕様
│   │   └── guide/                   # 各種ガイド
│   ├── CLAUDE.md                    # 開発仕様書（このファイル）
│   └── README.md                    # プロジェクト概要
│
├── 🧪 **テスト・品質管理**
│   ├── test/                        # テストファイル
│   ├── analysis_options.yaml        # Dart解析設定
│   └── pubspec.yaml                 # Flutter依存関係
│
└── 📦 **セッションログ**
    └── session_logs/                # 開発セッションログ
```

## 環境設定

### 開発環境
- **dev**: 開発環境（デバッグ・機能開発用）
- **stg**: ステージング環境（リリース前検証用）
- **prod**: 本番環境（一般ユーザー向け）

### Flavor設定
- Flavorを利用した環境切り替え
- 各環境で独立したSupabaseプロジェクト
- Bundle ID・アプリ名の環境別設定

## 実装品質・エラー対応方針

### 🔥 開発ルール詳細（必須遵守）

#### 🚫 強化開発ルール（絶対遵守・違反厳禁）

##### 絶対禁止事項（違反 = 開発失格）
1. **git操作の完全禁止**
   - `git checkout`, `git reset`, `git stash`, `git revert` など一切のgitコマンド使用禁止
   - 「復旧」「戻す」「リセット」と言われても、gitには絶対に触らない
   - ファイル編集のみで対応する（git操作は一切行わない）

2. **事前許可なしの作業禁止**
   - 1行のコード修正でも必ず事前に許可を取る
   - 「この方向で進めてよろしいですか？」を必ず確認
   - 許可なく作業を開始した場合は即座に停止
   - 「明らか」「簡単」でも許可は必須

3. **テストデータ・仮データの使用禁止**
   - 'test_', 'dummy_', 'sample_', '仮の' などの仮データ禁止
   - 既存の実装方法を必ず確認してから実装
   - 不明な場合は質問する

4. **勝手な判断・推測による作業禁止**
   - 「多分こうだろう」「きっとこうだ」での実装禁止
   - 不明点は必ず質問してから進める

##### 事前許可ルール（最優先・例外なし）
- **毎回必ず最初に開発ルールを読み込み確認する**
- **ファイル編集・修正前に必ず許可を求める**
- **UI・動作・ログに関わるすべての変更は事前許可必須**
- **ファイル修正でエラーが発生しても勝手に元に戻さない**
- **問題が発生したら状況説明して指示を仰ぐ**
- **不明・迷いがある場合は必ず質問する**
- **過去の経験や「明らか」と思っても必ず許可を取る**

#### 📋 技術実装ルール
1. **Supabase運用**
   - 全データはSupabase PostgreSQLで管理
   - 適切なエラーハンドリングと空データ対応
   - Row Level Security (RLS) ポリシー遵守

2. **品質保証**
   - 実装後は必ず `flutter analyze` でエラーチェック
   - `dart format` でコード整形
   - 未使用インポート・変数の削除

3. **動作確認の分担**
   - ユーザー側でhot reloadによる動作確認を実施
   - 開発者は品質チェックと許可確認のみ実行
   - 画面修正時は影響範囲を事前確認し許可を得る

4. **依存関係管理の原則**
   - 依存関係を直す場合は、基本的にバージョンが新しい方に合わせる
   - パッケージ、ライブラリを利用する際は最新バージョンで利用を検討する

5. **ドキュメント更新の義務化**
   - 機能実装完了時は必ずdocsフォルダのMDファイルに反映する
   - 実装状況・技術仕様・使用方法を詳細に記録する
   - 未来の開発・保守での参照性を重視する
   - 実装と同時にドキュメント更新することで情報の整合性を保つ

### 自動品質チェック（必須実行）
実装後は必ず以下を自動実行してください：

1. **Dart Analyzer チェック**
   ```bash
   flutter analyze
   ```
   - すべてのエラーを修正
   - 重要な警告も解消
   - 未使用インポート・変数の削除

2. **コードフォーマット適用**
   ```bash
   dart format .
   ```
   - Dart標準フォーマットに準拠
   - インデント・改行の統一
   - 可読性の向上

### エラー対応の原則
- **コンパイルエラーは即座に修正**
- **警告も可能な限り解消**
- **Null safety の適切な対応**
- **未使用コードの除去**
- **適切な例外処理の実装**

### 実装完了の定義
以下がすべて満たされた状態を「実装完了」とします：
- ✅ `flutter analyze` でエラー・重要警告なし
- ✅ `dart format .` 適用済み
- ✅ 実装した機能のコードが完成
- ✅ 開発ルールを遵守

## コーディング規約
- Dart effective dart に準拠
- Clean Architecture パターン
- コンポーネントの再利用性重視
- 適切なコメントとドキュメント

## データベース命名規則

### テーブル命名規則（プレフィックスベース）
- **ユーザー系**: `users` (単一テーブル)
- **グループ系**: `groups`, `group_members` (例: groups, group_members)
- **TODO系**: `todos`, `todo_assignments`, `todo_comments` (例: todos, todo_assignments)
- **定期TODO系**: `recurring_todos` (例: recurring_todos)
- **招待系**: `invite_codes` (例: invite_codes)

この命名規則により、テーブル名から管理対象が即座に判別できます。

## よく使用するコマンド

```bash
# アプリ起動
flutter run

# ホットリロード（アプリ起動中）
r キー

# 依存関係更新
flutter pub get

# 分析・リント
flutter analyze

# フォーマット
dart format .
```

## 関連ドキュメント

- `docs/requirements.md`: プロジェクト要件定義書
- `docs/guide/flutter_flavors_setup_guide.md`: Flutter Flavors設定ガイド
- `docs/guide/environment_setup_guide.md`: 環境設定ガイド

## 開発フェーズ

現在は **Phase 0: プロジェクト初期セットアップ** 段階です。

### Phase 0: プロジェクト初期セットアップ
- ✅ プロジェクト要件定義書作成
- ✅ CLAUDE.md作成
- 🔄 Flutter Flavors設定
- 🔄 Supabase環境構築
- 🔄 基本的なディレクトリ構造作成

### Phase 1: MVP（最小限の機能）
- ユーザー管理（デバイスベース認証）
- グループ作成・招待
- 基本的なTODO管理（作成・編集・削除・完了）
- リアルタイム同期

### Phase 2: 基本機能拡充
- TODO担当者設定
- カテゴリ・フィルター機能
- 期限設定・通知
- コメント機能

### Phase 3: 高度な機能
- 定期TODO機能
- データ引き継ぎ機能
- TODOテンプレート機能

## 最新の実装状況

### 現在の状況
- プロジェクト初期段階
- ドキュメント整備中
- 環境設定準備中

---

**最終更新日**: 2025-09-30