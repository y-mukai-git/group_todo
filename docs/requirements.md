# グループTODO - プロジェクト要件定義書

## プロジェクト概要

家族や知人とリアルタイムでTODOを共有・管理できるグループTODOアプリ。
買い物リストや家事の管理など、日常的なタスク管理を複数人で効率的に行うことを目的とする。

## 基本コンセプト

- **リアルで知り合っている人同士の利用**: SNS要素なし、招待制
- **シンプルなTODO管理**: 個人TODO・グループTODOを統合管理
- **デバイスベース認証**: メールアドレス不要、デバイスに紐づくユーザーID
- **データ引き継ぎ対応**: ユーザーID + パスワードによるデータ移行
- **オフライン対応**: 個人TODOはオフラインでも利用可能
- **iOSファースト**: まずはiOSアプリに注力

## ターゲットユーザー

- **家族**: 買い物リスト、家事分担の管理
- **同居人**: ルームメイトとの家事・買い物管理
- **小規模チーム**: 少人数グループでのタスク管理

## 主要機能

### 1. ユーザー管理

#### デバイスベース認証
- デバイス初回起動時に自動的にユーザーIDを払い出し
- メールアドレス・電話番号の登録不要
- ユーザー名とアバター設定（任意）

#### データ引き継ぎ
- ユーザーID・パスコードを用いた引き継ぎ機能
- デバイス変更時に既存データを新デバイスに移行
- QRコード方式での引き継ぎ対応

### 2. グループ機能

#### グループ作成・管理
- グループの新規作成
- グループ名・説明の設定
- グループアイコン設定（カラー選択）

#### メンバー招待
- 招待コード生成（6桁の英数字）
- QRコード招待
- 招待コードの有効期限設定
- メンバー一覧表示

#### グループ設定
- グループ名・アイコンの変更
- メンバーの退出・削除
- グループの削除（オーナーのみ）

### 3. TODO管理

#### TODO分類
- **個人TODO（マイTODO）**: グループに所属しない完全個人用TODO
  - 誰にも見えない・共有されない
  - オフライン完全対応（ローカルDB保存）
  - ネットワーク復帰時にSupabaseと自動同期
- **グループTODO**: グループに紐づくTODO
  - グループメンバー全員に見える
  - オンライン前提（Supabase管理）
  - 閲覧はキャッシュ可能

#### TODO作成
- タイトル・詳細説明
- 期限設定（任意）
- 担当者設定（グループTODOの場合、複数選択可）
- カテゴリ設定（買い物、家事、その他など）

#### TODO表示
- 個人TODO一覧（My TODO画面）
- グループ別TODO一覧
- 未完了・完了済みの切り替え表示
- 担当者別フィルター（グループTODO）
- カテゴリ別フィルター
- 期限順ソート

#### TODO操作
- 完了・未完了の切り替え
- 編集・削除
- コメント追加（グループTODO）

#### TODO通知
- 期限が近いTODOの通知
- 新規TODOが追加された通知（グループTODO）
- 担当TODOの通知（グループTODO）

### 4. 定期TODO機能

#### 定期TODO設定
- 毎日・毎週・毎月の繰り返し設定
- 曜日指定（毎週火曜日、など）
- 日付指定（毎月15日、など）
- 自動生成タイミング設定

#### 定期TODO管理
- 定期TODOテンプレート一覧
- 一時停止・再開機能
- 定期TODO削除

### 5. TODOテンプレート・提案機能（検討中）

#### よく使うTODOの提案
- グループ内でよく作成されるTODOを分析
- 定期的に使われるTODOをテンプレート化
- AI活用でTODOを提案（オプション機能）

#### テンプレート機能
- TODOテンプレート作成
- テンプレートからTODO作成
- グループ内でテンプレート共有

## 技術仕様

### フロントエンド

- **フレームワーク**: Flutter 3.24+
- **言語**: Dart
- **状態管理**: StatefulWidget + Service Layer Pattern
- **UI**: Material Design 3準拠
- **アーキテクチャ**: Service-based Architecture with Clean separation

### バックエンド・インフラ

- **データベース**: Supabase PostgreSQL（マスターデータ）
- **ローカルDB**: SQLite（個人TODO・オフライン対応）
- **認証**: デバイスベース認証 + SharedPreferences
- **ストレージ**: Supabase Storage（将来的に画像対応）
- **リアルタイム同期**: Supabase Realtime

### データ保存戦略

#### 基本方針
**すべてのデータは基本的にオンライン（Supabase）で管理**

| データ種類 | 保存先 | オフライン時の動作 |
|---------|--------|----------------|
| 認証情報（ユーザーID・表示名） | SharedPreferences | ローカルから読み込み（高速起動） |
| アプリ設定 | SharedPreferences | ローカルから読み込み |
| **個人TODO** | Supabase + SQLite | 作成・編集可能（ローカルに一時保存 → オンライン復帰時に同期） |
| **グループTODO** | Supabase + キャッシュ | 閲覧のみ可能（編集不可） |
| ユーザー情報 | Supabase | 取得不可（既存キャッシュ利用） |
| グループ情報 | Supabase | 取得不可（既存キャッシュ利用） |

#### オフライン時の挙動

**通常時（オンライン）:**
- 個人TODO → Supabase に即座に保存
- グループTODO → Supabase に即座に保存

**オフライン時:**
- 個人TODO → SQLiteに一時保存（`sync_status: pending_create/update/delete`）
  - オンライン復帰時に Supabase へ自動同期
- グループTODO → 編集不可（キャッシュされた既存データの閲覧のみ）

#### SharedPreferencesの使用制限
メモリ圧迫を避けるため、以下のみ保存：
- ユーザーID
- ユーザー表示名
- 最終同期日時
- アプリ設定（通知ON/OFF等）

**TODOデータはSharedPreferencesに保存しない**（SQLiteとSupabaseのみ）

### 開発環境

#### 環境分離
- **dev**: 開発環境
- **stg**: ステージング環境
- **prod**: 本番環境

#### Flavor設定
- Flavorを利用した環境切り替え
- 各環境で独立したSupabaseプロジェクト
- Bundle ID・アプリ名の環境別設定

### 開発・品質管理

- **静的解析**: Flutter Analyzer
- **フォーマット**: Dart Format
- **バージョン管理**: Git + GitHub

## データベース設計概要

### 主要テーブル

#### users
- ユーザー基本情報
- デバイスID、ユーザー名、アバター
- 作成日時、最終アクセス日時

#### groups
- グループ基本情報
- グループ名、説明、アイコン
- オーナーID、作成日時

#### group_members
- グループメンバー管理
- グループID、ユーザーID
- 参加日時、ロール（オーナー・メンバー）

#### todos
- TODO基本情報
- タイトル、詳細、期限
- グループID（NULLの場合は個人TODO）、作成者ID
- ステータス（未完了・完了）
- カテゴリ、優先度

#### local_todos（SQLite - ローカルのみ）
- 個人TODO一時保存用
- Supabase todosテーブルと同一構造
- 同期ステータス管理（`sync_status`）:
  - `synced`: Supabaseと同期済み
  - `pending_create`: 作成待ち
  - `pending_update`: 更新待ち
  - `pending_delete`: 削除待ち
- オンライン復帰時に自動同期

#### todo_assignments
- TODO担当者管理
- TODO ID、ユーザーID

#### todo_comments
- TODOコメント
- TODO ID、ユーザーID、コメント内容

#### recurring_todos
- 定期TODO設定
- TODO テンプレート情報
- 繰り返し設定（頻度、曜日、日付）
- 次回生成日時

#### invite_codes
- グループ招待コード管理
- グループID、招待コード
- 有効期限、使用回数制限

## UI/UX方針

### デザインシステム

#### カラーパレット
- **プライマリー**: 緑系（タスク完了の達成感）
- **セカンダリー**: オレンジ系（アクション強調）
- **背景**: 白・グレー系（シンプル・見やすさ重視）

#### レイアウト
- カードベースのUI
- スワイプジェスチャー対応（完了・削除）
- Bottom Navigation（ホーム・グループ・設定）

### 主要画面構成

1. **ホーム画面**: 全グループの未完了TODO一覧
2. **グループ画面**: グループ一覧、グループ詳細
3. **TODO詳細画面**: TODO情報、コメント、編集
4. **設定画面**: ユーザー設定、通知設定、データ引き継ぎ

## 開発フェーズ

### Phase 1: MVP（最小限の機能）
- ユーザー管理（デバイスベース認証）
- グループ作成・招待
- 基本的なTODO管理（作成・編集・削除・完了）
- リアルタイム同期

### Phase 2: 基本機能拡充
- TODO担当者設定
- カテゴリ・フィルター機能
- 期限設定・通知
- コメント機能

### Phase 3: 高度な機能
- 定期TODO機能
- データ引き継ぎ機能
- TODOテンプレート機能

### Phase 4: 提案・AI機能（検討中）
- よく使うTODO提案
- AI活用によるTODO提案

## セキュリティ・プライバシー

### データ保護
- Supabase Row Level Security (RLS) による適切なアクセス制御
- ユーザーは自分が所属するグループのデータのみアクセス可能
- 招待コードによる厳格なグループ参加管理

### 匿名性
- メールアドレス・電話番号不要
- 個人を特定できる情報は保存しない
- グループ内のみで表示されるユーザー名・アバター

## 将来的な拡張計画

### 短期（6ヶ月以内）
- Androidアプリ対応
- 画像添付機能（買い物リストの写真など）
- リマインダー機能の強化

### 中期（6ヶ月〜1年）
- Web版対応
- カレンダー連携
- 統計・インサイト機能（完了率など）

### 長期（1年以上）
- 多言語対応
- サードパーティ連携（Googleカレンダーなど）
- オフライン対応

## 参考・類似アプリ

- **Google Keep**: シンプルなメモ・TODO管理
- **Todoist**: 高機能TODO管理
- **Any.do**: ファミリーリスト機能
- **OurGroceries**: 買い物リスト特化

## プロジェクト目標

- シンプルで使いやすいグループTODO管理
- リアルタイム同期による快適な共同作業
- プライバシーに配慮した設計（メールアドレス不要）
- 日常的に使いたくなるUX

---

**最終更新日**: 2025-09-30